# CRUD Operations

## Adding new tasks

Now that we can see the list of tasks, it's time to add a few more.

Add the highlighted `newTaskTitle` state and `addTask` function the Home Component

```ts{5-16}
// src/pages/index.tsx

export default function Home() {
  const [tasks, setTasks] = useState<Task[]>([])
  const [newTaskTitle, setNewTaskTitle] = useState("")

  const addTask = async (e: FormEvent) => {
    e.preventDefault()
    try {
      const newTask = await taskRepo.insert({ title: newTaskTitle })
      setTasks((tasks)=>[...tasks, newTask])
      setNewTaskTitle("")
    } catch (error: any) {
      alert(error.message)
    }
  }
  //...
```

- the call to `taskRepo.insert` will make a post request to the server, insert the new task to the `db`, and return the new `Task` object with all it's info (including the id generated by the database)

::: warning Import FormEvent
This code requires adding an import of `FormEvent` from `react`.
:::

Next let's adjust the `tsx` to display a form to add new tasks

```tsx{7-14}
// src/pages/index.tsx

return (
  <div>
    <h1>Todos</h1>
    <main>
      <form onSubmit={addTask}>
        <input
          value={newTaskTitle}
          placeholder="What needs to be done?"
          onChange={e => setNewTaskTitle(e.target.value)}
        />
        <button>Add</button>
      </form>
      {tasks.map(task => {
        return (
          <div key={task.id}>
            <input type="checkbox" checked={task.completed} />
            {task.title}
          </div>
        )
      })}
    </main>
  </div>
)
```

Try adding a few tasks to see how it works

## Mark Tasks as completed

Add the `setTask`, `setCompleted` functions within the `Home` component

```tsx{5-6,8-9,16}
// src/pages/index.tsx

export default function Home() {
  //...
  const setTask = (value: Task) =>
    setTasks((tasks) => tasks.map((t) => (t.id === value.id ? value : t)));

  const setCompleted = async (task: Task, completed: boolean) =>
    setTask(await taskRepo.save({ ...task, completed }));

//...
}
```
- The `setTask` function is used to replace the state of the changed task in the `tasks` array
- The `taskRepo.save` method update the `task` to the server and returns the updated value

Modify the contents of the `tasks.map` iteration within the `Home` component, call `setCompleted` in the input's `onChange` event.

```tsx{10}
// src/pages/index.tsx

  {
    tasks.map(task => {
      return (
        <div key={task.id}>
          <input
            type="checkbox"
            checked={task.completed}
            onChange={(e) => setCompleted(task, e.target.checked)}
          />
          {task.title}
        </div>
      )
    })
    //...
```

## Rename Tasks and Save them

To make the tasks in the list updatable, we'll bind the `tasks` React state to `input` elements and add a _Save_ button to save the changes to the backend database.

Add the `setTitle`, `saveTask` functions within the `Home` component

```tsx{11,13-19}
// src/pages/index.tsx

export default function Home() {
  //...
  const setTask = (value: Task) =>
    setTasks((tasks) => tasks.map((t) => (t.id === value.id ? value : t)));

  const setCompleted = async (task: Task, completed: boolean) =>
    setTask(await taskRepo.save({ ...task, completed }));

  const setTitle = (task: Task, title: string) => setTask({ ...task, title });

  const saveTask = async (task: Task) => {
    try {
      await taskRepo.save(task);
    } catch (error: any) {
      alert(error.message);
    }
  };
//...

}
```
Within the `tasks.map` iteration in the `return` section of the `Home` component, add an `input` and a save `button`.

```tsx{12-14}
// src/pages/index.tsx

{
  tasks.map(task => {
    return (
      <div key={task.id}>
        <input
          type="checkbox"
          checked={task.completed}
          onChange={e => setCompleted(e.target.checked)}
        />
         <input value={task.title} 
            onChange={(e) => setTitle(task, e.target.value)} />
         <button onClick={() => saveTask(task)}>Save</button>
      </div>
    )
  })
}
```

- The `setTitle` function, called from the `input`'s `onChange` event, saves the value from the `input` to the `tasks` state.
- The `saveTask` function, called from the `button`'s' `onClick`event, saves the `task` object to the backend.

Make some changes and refresh the browser to verify the backend database is updated.

::: tip Browser's Network tab
As you play with these `CRUD` capabilities, monitor the network tab and see that they are all translated to `rest` api calls.
:::

## Delete Tasks

Let's add a _Delete_ button next to the _Save_ button of each task in the list.

Add the highlighted `deleteTask` function within the `Home` component

```tsx{21-28}
// src/pages/index.tsx

export default function Home() {
  //...
  const setTask = (value: Task) =>
    setTasks((tasks) => tasks.map((t) => (t.id === value.id ? value : t)));

  const setCompleted = async (task: Task, completed: boolean) =>
    setTask(await taskRepo.save({ ...task, completed }));

  const setTitle = (task: Task, title: string) => setTask({ ...task, title });

  const saveTask = async (task: Task) => {
    try {
      await taskRepo.save(task);
    } catch (error: any) {
      alert(error.message);
    }
  };

  const deleteTask = async (task: Task) => {
    try {
      await taskRepo.delete(task);
      setTasks((tasks) => tasks.filter((t) => t !== task));
    } catch (error: any) {
      alert(error.message);
    }
  };
//...

}
```
Within the `tasks.map` iteration in the `return` section of the `Home` component, add a _Delete_ `button`.

```tsx{15}
// src/pages/index.tsx

{
  tasks.map(task => {
    return (
      <div key={task.id}>
        <input
          type="checkbox"
          checked={task.completed}
          onChange={e => setCompleted(e.target.checked)}
        />
         <input value={task.title} 
            onChange={(e) => setTitle(task, e.target.value)} />
         <button onClick={() => saveTask(task)}>Save</button>
         <button onClick={() => deleteTask(task)}>Delete</button>

      </div>
    )
  })
}
```