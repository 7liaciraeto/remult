# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs:
  codecov: codecov/codecov@3.1.1
  node: circleci/node@5.0.0
  browser-tools: circleci/browser-tools@1.2.5
# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
# jobs:
jobs:
  install-node:
    docker:
      - image: 'cimg/base:stable'
    steps:
      - checkout
      - node/install:
          node-version: '16.18'
      - run: node --version
# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
    build:
      jobs:
        - install-node
        - node/run:
            name: build
            npm-run: build-core 
        - node/test:
            name: test
            run-command: test:ci
            setup: 
              - browser-tools/install-chrome
              - browser-tools/install-chromedriver
              - run:
                  command: |
                    google-chrome --version
                    chromedriver --version
                  name: Check install
            post-steps:
              - codecov/upload
