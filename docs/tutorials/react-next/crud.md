# CRUD Operations

## Adding new tasks

Now that we can see the list of tasks, it's time to add a few more.

Add the highlighted `newTaskTitle` state and `addTask` function the Home Component

_src/pages/index.tsx_

```ts{3-14}
export default function Home() {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [newTaskTitle, setNewTaskTitle] = useState("");

  const addTask = async (e: FormEvent) => {
    e.preventDefault();
    try {
      const newTask = await taskRepo.insert({ title: newTaskTitle });
      setTasks([...tasks, newTask]);
      setNewTaskTitle("");
    } catch (error: any) {
      alert(error.message);
    }
  };

  useEffect(() => {
    fetchTasks().then(setTasks);
  }, []);
```

- the call to `taskRepo.insert` will make a post request to the server, insert the new task to the `db`, and return the new `Task` object with all it's info (including the id generated by the database)

::: warning Import FormEvent
This code requires adding an import of `FormEvent` from `react`.
:::

Next let's adjust the `tsx` to display a form to add new tasks

_src/pages/index.tsx_

```tsx{5-13}
return (
  <div className="flex items-center justify-center h-screen bg-gray-50 text-lg flex-col">
    <h3 className="text-6xl text-red-500 italic">Todos</h3>
    <main className="bg-white border rounded-lg  shadow-lg flex flex-col w-screen m-5 max-w-md">
      <form onSubmit={addTask} className="border-b-2 p-2 px-6 flex">
        <input
          className="w-full placeholder:italic focus:outline-none "
          value={newTaskTitle}
          placeholder="What needs to be done?"
          onChange={(e) => setNewTaskTitle(e.target.value)}
        />
        <button className="text-4xl">+</button>
      </form>
      {tasks.map((task) => (
        <div key={task.id} className="flex border px-6 py-2 gap-2">
          <input
            className="w-6 mr-2"
            type="checkbox"
            checked={task.completed}
          />
          {task.title}
        </div>
      ))}
    </main>
  </div>
);
```

Try adding a few tasks to see how it works

## Mark Tasks as completed

Modify the contents of the `tasks.map` iteration within the `Home` component to include the following `setCompleted` function and call it in the input's `onChange` event.

_src/pages/index.tsx_

```tsx{3-4,6-7,15}
{
  tasks.map((task) => {
    const setTask = (value: Task) =>
      setTasks(tasks.map((t) => (t === task ? value : t)));

    const setCompleted = async (completed: boolean) =>
      setTask(await taskRepo.save({ ...task, completed }));

    return (
      <div key={task.id} className="flex border px-6 py-2 gap-2">
        <input
          className="w-6 mr-2"
          type="checkbox"
          checked={task.completed}
          onChange={(e) => setCompleted(e.target.checked)}
        />
        {task.title}
      </div>
    );
  });
}
```

- The `setTask` function is used to replace the state of the changed task in the `tasks` array
- The `taskRepo.save` method update the `task` to the server and returns the updated value

## Rename Tasks and Save them

To make the tasks in the list updatable, we'll bind the `tasks` React state to `input` elements and add a _Save_ button to save the changes to the backend database.

Modify the contents of the `tasks.map` iteration within the `Home` component to include the following `setTitle` and `saveTask` functions and add an `input` and a save `button`.

_src/pages/index.tsx_

```tsx{9,11-16,27-47}
{
  tasks.map((task) => {
    const setTask = (value: Task) =>
      setTasks(tasks.map((t) => (t === task ? value : t)));

    const setCompleted = async (completed: boolean) =>
      setTask(await taskRepo.save({ ...task, completed }));

    const setTitle = (title: string) => setTask({ ...task, title });

    const saveTask = async () => {
      try {
        setTask(await taskRepo.save(task));
      } catch (error) {
        alert(error.message);
      }
    };

    return (
      <div key={task.id} className="flex border px-6 py-2 gap-2">
        <input
          type="checkbox"
          className="w-6 mr-2"
          checked={task.completed}
          onChange={(e) => setCompleted(e.target.checked)}
        />
        <input
          className="w-full focus:outline-none"
          value={task.title}
          onChange={(e) => setTitle(e.target.value)}
        />
        <button onClick={saveTask}>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-6 h-6"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M4.5 12.75l6 6 9-13.5"
            />
          </svg>
        </button>
      </div>
    );
  });
}
```

- The `setTitle` function, called from the `input`'s `onChange` event, saves the value from the `input` to the `tasks` state.
- The `saveTask` function, called from the `button`'s' `onClick`event , saved the `task` object to the backend.
- The button's icon is an `svg` icon, copied from the [heroicons website](https://heroicons.com/)

Make some changes and refresh the browser to verify the backend database is updated.

::: tip Browser's Network tab
As you play with these `CRUD` capabilities, monitor the network tab and see that they are all translated to `rest` api calls.

## Delete Tasks

Let's add a _Delete_ button next to the _Save_ button of each task in the list.

Add the highlighted `deleteTask` function and _Delete_ `button` Within the `tasks.map` iteration in the `return` section of the `Home` component.

_src/pages/index.tsx_

```tsx{1-4,6-21}
const deleteTask = async () => {
  await remult.repo(Task).delete(task);
  setTasks(tasks.filter((t) => t !== task));
};
//...
<button onClick={deleteTask}>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    strokeWidth={1.5}
    stroke="currentColor"
    className="w-6 h-6"
  >
    <path
      strokeLinecap="round"
      strokeLinejoin="round"
      d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
    />
  </svg>
</button>;
```
